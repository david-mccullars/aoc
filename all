#!/usr/bin/env bash

# Run all Advent of Code solutions for all years

# Colors for output
PURPLE='\033[0;35m'
YELLOW='\033[33m'
RESET='\033[0m'

# Load chruby if available
if [ -f /opt/dev/sh/chruby/chruby.sh ]; then
    source /opt/dev/sh/chruby/chruby.sh
fi

# Find all year directories and sort them
for year_dir in $(ls -d [0-9][0-9][0-9][0-9] 2>/dev/null | sort); do
    echo -e "${PURPLE}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ ${YELLOW}Year $year_dir ${PURPLE}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${RESET}"
    
    # Change to year directory
    cd "$year_dir"
    
    # Determine if this is a Rust or Ruby year
    if [ -f "Cargo.toml" ]; then
        # Rust year - run cargo solve for each day
        for day in $(seq -f "%02g" 1 25); do
            if [ -f "data/inputs/${day}.txt" ] || [ -f "src/bin/${day}.rs" ]; then
                echo -e "${PURPLE}────────────────────────────── ${YELLOW}Day ${day} ${PURPLE}───────────────────────────────${RESET}"
                cargo solve "$day" --quiet || exit 1
                echo
            fi
        done
    elif [ -f "Gemfile" ]; then
        if [ -f ".ruby-version" ] && command -v chruby &> /dev/null; then
            chruby "$(cat .ruby-version)"
        fi
        
        for day in $(seq -f "%02g" 1 25); do
            if [ -f "${day}.rb" ]; then
                echo -e "${PURPLE}────────────────────────────── ${YELLOW}Day ${day} ${PURPLE}───────────────────────────────${RESET}"
                ruby "${day}.rb" || exit 1
                echo
            fi
        done
    else
        echo "Warning: Cannot determine project type for $year_dir"
    fi
    
    # Return to parent directory
    cd ..
    echo
done
